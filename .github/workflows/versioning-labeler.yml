name: Versioning Labeler

on:
    pull_request_target:
        types: [opened, synchronize, reopened, ready_for_review]

permissions:
    contents: read
    pull-requests: write
    issues: write

jobs:
    label:
        runs-on: ubuntu-latest
        steps:
            - name: Add version label based on changed files
              uses: actions/github-script@v7
              with:
                  script: |
                      const owner = context.repo.owner;
                      const repo = context.repo.repo;
                      const pr = context.payload.pull_request;
                      if (!pr) core.setFailed("No pull_request in context");
                      
                      // List changed files via API (no checkout!)
                      const files = await github.paginate(
                        github.rest.pulls.listFiles,
                        { owner, repo, pull_number: pr.number, per_page: 100 }
                      );
                      
                      const paths = files.map(f => f.filename);
                      
                      // Beispiel-Regeln â€“ HIER deine Policy abbilden
                      // (z.B. doc-only => version:none, sonst version:patch/minor/major)
                      let label = "version:patch";
                      const onlyDocs = paths.every(p =>
                        p.startsWith("docs/") ||
                        p.endsWith(".md") ||
                        p.startsWith(".github/")
                      );
                      if (onlyDocs) label = "version:none";
                      
                      // Apply label
                      await github.rest.issues.addLabels({
                        owner, repo, issue_number: pr.number, labels: [label],
                      });
                      
                      core.info(`Applied label: ${label}`);
