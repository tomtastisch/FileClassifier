# Code Analysis Method

## 1. Goal
Provide reproducible, file-level and line-level analysis artifacts without changing public APIs.

## 2. Machine Outputs (JSON only)
Generated by `tools/audit/generate-code-analysis-json.sh`:
- `artifacts/audit/code_inventory.json`
- `artifacts/audit/callgraph_inventory.json`
- `artifacts/audit/dead_code_candidates.json`
- `artifacts/audit/redundancy_candidates.json`
- `artifacts/audit/hardening_candidates.json`

CI evidence contract for cluster-7 execution:
- `artifacts/ci/code-analysis-evidence/raw.log`
- `artifacts/ci/code-analysis-evidence/summary.md`
- `artifacts/ci/code-analysis-evidence/result.json`

## 3. Current Analysis Mode
Heuristic baseline (wave 1):
- declaration extraction by regex
- repository symbol reference counts
- repeated long-line redundancy heuristic
- broad exception catch detection (only explicit generic forms: `As Exception`)

## 4. Escalation Path
For high-confidence refactors, each candidate must be validated by:
1. direct code inspection
2. failing/targeted test before change (where applicable)
3. passing regression tests after change

## 5. Repro
All commands are intended to run from the repository root.
```bash
bash tools/audit/generate-code-analysis-json.sh
bash tools/audit/verify-code-analysis-evidence.sh
```

## 6. Baseline Snapshot
Snapshots are point-in-time outputs of the current heuristic and will drift as code changes.

Repro (repo root):
```bash
bash tools/audit/verify-code-analysis-evidence.sh
jq '.candidates | length' artifacts/audit/hardening_candidates.json
jq '.candidates | length' artifacts/audit/redundancy_candidates.json
jq '.candidates | length' artifacts/audit/dead_code_candidates.json
```

### 6.1 Snapshot (2026-02-13)
- inventory files (`src/*.vb|*.cs`): `22`
- method declarations (heuristic): `698`
- dead code candidates (heuristic): `0`
- redundancy candidates (heuristic): `18`
- hardening candidates (broad catches): `12`

### 6.2 Snapshot (2026-02-15)
- inventory files (`src/*.vb|*.cs`): `22`
- method declarations (heuristic): `683`
- dead code candidates (heuristic): `0`
- redundancy candidates (heuristic): `18`
- hardening candidates (broad catches): `21`
